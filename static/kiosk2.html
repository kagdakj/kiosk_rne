<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>키오스크 미니 프리뷰 (Scaled)</title>
<style>
  :root{
    --uiScale: 0.75;           /* 전체 UI 축소 배율 (0.5 ~ 1.25 권장) */
    --frameW: 950px;           /* 원본 앱의 기준 너비 */
    --frameH: 640px;           /* 원본 앱의 기준 높이(보이는 영역) */
    --bg: #0b0b0c; --fg: #f5f5f7; --muted:#9aa0a6; --accent:#2563eb;
  }
  html,body{ height:100%; }
  body{ margin:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif; }

  header{ position:sticky; top:0; z-index:10; padding:10px 14px; background:#121214; border-bottom:1px solid #2a2a2a; display:flex; gap:12px; align-items:center; }
  header h1{ font-size:1rem; margin:0; }
  .sp{ flex:1; }
  .btn{ cursor:pointer; border:1px solid #34363a; background:#1b1d22; color:#e6e6ea; padding:10px 12px; border-radius:10px; font-weight:700; }
  .btn.primary{ background:var(--accent); color:#fff; border-color: transparent; }
  input[type="range"]{ width: 200px; }

  /* 미니 프레임 래퍼: 화면 중앙 배치 */
  .wrap{ min-height: calc(100vh - 56px); display:flex; align-items:center; justify-content:center; padding: 16px; }
  .frame{ position:relative; width: calc(var(--frameW) * var(--uiScale)); height: calc(var(--frameH) * var(--uiScale)); border-radius:18px; box-shadow: 0 14px 38px rgba(0,0,0,.45), 0 6px 18px rgba(0,0,0,.35); background:#0f0f11; }
  .chrome{ position:absolute; inset:0; pointer-events:none; border:1px solid #2a2a2a; border-radius:18px; }
  .scale-shell{ position:absolute; left:0; top:0; transform-origin: top left; transform: scale(var(--uiScale)); width: calc(var(--frameW)); height: calc(var(--frameH)); overflow:hidden; }
  .note{ color:var(--muted); font-size:.9rem; }

  /* ===== 원본 키오스크 앱(처음 만든 버전)을 내장 ===== */
  /* 핵심: 원본은 가급적 수정하지 않고, 아래 #appRoot를 통째로 scale-shell 안에 넣는다 */

  /* 원본 스타일(요약본) */
  .app header{ position:sticky; top:0; background:#fff; color:#111; border-bottom:1px solid #e5e7eb; padding:10px 14px; display:flex; align-items:center; gap:10px; }
  .app header .title{ font-weight:900; }
  .app main{ max-width: 980px; margin: 0 auto; padding:14px; font-size:16px; }
  .app .row{ display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
  .app .sp{ flex:1; }
  .app .btn{ cursor:pointer; user-select:none; border:none; border-radius:14px; font-weight:800; padding:12px 16px; background:#2563eb; color:#fff; }
  .app .btn.ghost{ background:#f3f4f6; color:#111; border:1px solid #e5e7eb; }
  .app .card{ background:#f8fafc; border:1px solid #e5e7eb; border-radius:14px; padding:14px; }
  .app .grid{ display:grid; gap:12px; }
  .app .cols-2{ grid-template-columns: 1.2fr .8fr; }
  .app .items{ display:grid; gap:12px; grid-template-columns: repeat(2, minmax(0,1fr)); }
  .app .item{ display:flex; align-items:center; justify-content:space-between; gap:10px; background:#fff; color:#111; border:1px solid #e5e7eb; border-radius:14px; padding:14px; min-height:72px; }
  .app .chip{ border:1px solid #e5e7eb; border-radius:999px; padding:8px 12px; background:#fff; color:#111; font-weight:700; }
  .app .chip.on{ background:#2563eb; color:#fff; border-color:transparent; }
  .app .sticky-btm{ position:sticky; bottom:0; background:#fff; border-top:1px solid #e5e7eb; padding:10px 0; }

  @media (max-width: 980px){ :root{ --frameW: 840px; --frameH: 620px; } }
  @media (max-width: 860px){ :root{ --frameW: 720px; --frameH: 600px; } }
  @media (max-width: 740px){ :root{ --frameW: 560px; --frameH: 560px; } }
  @media (max-width: 600px){ :root{ --frameW: 520px; --frameH: 560px; } }
  /* ==== Vertical anchor movement (top/middle/bottom) with smooth animation ==== */
  .wrap{ min-height: calc(100vh - 56px); display:flex; flex-direction: column; align-items:center; justify-content:center; padding:16px; }
  .frame{ position:relative; width: calc(var(--frameW) * var(--uiScale)); height: calc(var(--frameH) * var(--uiScale)); border-radius:18px; box-shadow: 0 14px 38px rgba(0,0,0,.45), 0 6px 18px rgba(0,0,0,.35); background:#0f0f11; will-change: transform; }
  .anchor-indicator{ pointer-events:none; position:fixed; left:12px; bottom:12px; color:var(--muted); font-size:.9rem; }
</style>
</head>
<body>
  <header>
    <h1>키오스크 미니 프리뷰</h1>
    <div class="sp"></div>
    <label>배율 <input id="scale" type="range" min="0.50" max="1.25" step="0.01" value="0.75" /></label>
    <button class="btn" data-z="0.50">50%</button>
    <button class="btn" data-z="0.75">75%</button>
    <button class="btn" data-z="1.00">100%</button>
    <button class="btn" data-z="1.10">110%</button>
    <div class="sp"></div>
    <button class="btn" id="anchorTop" title="위로">위로</button>
    <button class="btn" id="anchorMid" title="가운데">가운데</button>
    <button class="btn" id="anchorBot" title="아래로">아래로</button>
    <button class="btn primary" id="anchorAuto" title="자동">자동</button>
    <button class="btn" data-z="0.50">50%</button>
    <button class="btn" data-z="0.75">75%</button>
    <button class="btn" data-z="1.00">100%</button>
    <button class="btn" data-z="1.10">110%</button>
  </header>

  <div class="wrap">
    <div class="anchor-indicator" id="anchorInfo">ANCHOR: middle</div>
    <div class="frame">
      <div class="scale-shell">
        <!-- 원본 키오스크 앱 시작 (요약 버전) -->
        <div id="appRoot" class="app">
          <header>
            <div class="title">적응형 키오스크 (원본 축소 프리뷰)</div>
            <div class="sp"></div>
            <button class="btn ghost" id="aMinus">A−</button>
            <button class="btn ghost" id="aPlus">A＋</button>
          </header>

          <main class="grid cols-2">
            <section class="card" aria-labelledby="sec-menu">
              <h2 id="sec-menu">메뉴 선택</h2>
              <div class="row" id="catTabs"></div>
              <div class="items" id="itemGrid"></div>

              <div class="sticky-btm row">
                <button class="btn ghost" id="btnCancel">취소</button>
                <div class="sp"></div>
                <button class="btn" id="btnNext" disabled>다음</button>
              </div>
            </section>

            <aside class="card" aria-labelledby="sec-cart">
              <h2 id="sec-cart">장바구니</h2>
              <div id="cartList" class="grid" style="gap:8px;"></div>
              <hr />
              <div class="row" style="justify-content:space-between;">
                <div class="note">합계</div>
                <strong id="cartTotal">₩0</strong>
              </div>
              <div class="row" style="justify-content:flex-end; margin-top:8px;">
                <button class="btn ghost" id="btnClear">비우기</button>
              </div>
            </aside>

            <dialog id="optModal">
              <div class="card">
                <h3 id="optTitle" style="margin:0 0 10px 0;">옵션 선택</h3>
                <div class="row" id="optSize"></div>
                <div class="row" id="optSweet"></div>
                <div class="row" id="optIce"></div>
                <div class="row" style="justify-content:flex-end; margin-top:10px;">
                  <button class="btn ghost" id="optClose">취소</button>
                  <button class="btn" id="optOk">담기</button>
                </div>
              </div>
            </dialog>

            <section class="card" id="sectionConfirm" style="display:none;" aria-labelledby="sec-check">
              <h2 id="sec-check">주문 확인</h2>
              <div id="confirmList" class="grid" style="gap:8px;"></div>
              <div class="row" style="justify-content: space-between;">
                <div class="note">합계</div>
                <strong id="confirmTotal">₩0</strong>
              </div>
              <div class="row" style="justify-content:flex-end; margin-top:8px;">
                <button class="btn ghost" id="btnBackToMenu">메뉴로</button>
                <button class="btn" id="btnPay">결제하기</button>
              </div>
            </section>

            <section class="card" id="sectionPaid" style="display:none;" aria-labelledby="sec-paid">
              <h2 id="sec-paid">결제가 완료되었습니다</h2>
              <p class="note">주문 번호: <span id="orderNo"></span></p>
              <div class="row">
                <button class="btn" id="btnNew">새 주문</button>
              </div>
            </section>
          </main>
        </div>
        <!-- 원본 앱 끝 -->
      </div>
      <div class="chrome"></div>
    </div>
  </div>

<script>
(function(){
  /* ==== Vertical anchor state & animation ==== */
  const headerH = 56; // px (matches sticky header)
  const st = { anchor: 'middle', auto:true, ySmoothed: null, target: 0, cur: 0, lastSwitch: 0 };
  const $wrap = document.querySelector('.wrap');
  const $frame = document.querySelector('.frame');
  const $info = document.getElementById('anchorInfo');

  function metrics(){
    const vh = window.innerHeight;
    const available = Math.max(0, vh - headerH - 32 /*wrap padding top+bottom approx*/ - $frame.offsetHeight);
    const top = 0;
    const mid = available/2;
    const bot = available;
    return { top, mid, bot };
  }
  function setAnchor(pos){
    st.anchor = pos; st.auto = false; updateTarget(); updateIndicator();
  }
  function setAuto(on=true){ st.auto = on; updateIndicator(); }
  function updateIndicator(){ $info.textContent = `ANCHOR: ${st.auto? 'auto→':''}${st.anchor}`; }
  function updateTarget(){
    const m = metrics();
    st.target = (st.anchor==='top')? m.top : (st.anchor==='bottom'? m.bot : m.mid);
  }
  function lerp(a,b,t){ return a + (b-a)*t; }
  function animate(){
    st.cur = lerp(st.cur, st.target, 0.12);
    $frame.style.transform = `translateY(${st.cur}px)`;
    requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);

  // Auto logic from external faceY (0..1). Call window.uiAnchor.auto(y)
  function decideAnchorFromY(y){
    const now = performance.now();
    // smooth the signal
    st.ySmoothed = (st.ySmoothed==null)? y : (st.ySmoothed*0.85 + y*0.15);
    const yS = st.ySmoothed;
    // hysteresis thresholds
    const cur = st.anchor;
    let next = cur;
    if(cur==='top'){
      if(yS > 0.45) next = 'middle';
    }else if(cur==='middle'){
      if(yS < 0.30) next = 'top';
      else if(yS > 0.70) next = 'bottom';
    }else if(cur==='bottom'){
      if(yS < 0.55) next = 'middle';
    }
    // require dwell time 800ms before switching
    if(next!==cur && (now - st.lastSwitch) > 800){ st.anchor = next; st.lastSwitch = now; updateTarget(); updateIndicator(); }
  }

  // recompute on resize / scale change
  function recompute(){ updateTarget(); }
  window.addEventListener('resize', recompute);

  // expose API
  window.uiAnchor = {
    set(pos){ setAnchor(pos); },
    auto(y){ setAuto(true); if(typeof y==='number') decideAnchorFromY(Math.min(1, Math.max(0, y))); },
    enableAuto(){ setAuto(true); },
    disableAuto(){ setAuto(false); },
    get current(){ return st.anchor; }
  };

  // header controls
  document.getElementById('anchorTop').onclick = ()=> setAnchor('top');
  document.getElementById('anchorMid').onclick = ()=> setAnchor('middle');
  document.getElementById('anchorBot').onclick = ()=> setAnchor('bottom');
  document.getElementById('anchorAuto').onclick = ()=> setAuto(true);

  // initial
  updateTarget(); updateIndicator();

  /* === 프리뷰 스케일 조절 === */
  const range = document.getElementById('scale');
  const root = document.documentElement;
  function setScale(v){ root.style.setProperty('--uiScale', String(v)); /* frame size changes → recompute anchor positions */ setTimeout(()=>{ const ev=new Event('resize'); window.dispatchEvent(ev); }, 0); }
  range.addEventListener('input', e=> setScale(e.target.value));
  document.querySelectorAll('button[data-z]').forEach(b=> b.addEventListener('click', ()=>{ const v=b.dataset.z; range.value=v; setScale(v); }));

  /* === 원본 앱 로직(간단화 요약) === */
  const PRODUCTS = [
    { id:'a1', cat:'커피',   name:'아메리카노', price:2500 },
    { id:'a2', cat:'커피',   name:'카페라테',   price:3200 },
    { id:'a3', cat:'커피',   name:'바닐라라테', price:3600 },
    { id:'t1', cat:'티',     name:'녹차',       price:2800 },
    { id:'t2', cat:'티',     name:'얼그레이',   price:3000 },
    { id:'c1', cat:'초콜릿', name:'핫초코',     price:3000 },
    { id:'s1', cat:'스낵',   name:'쿠키',       price:1800 },
    { id:'s2', cat:'스낵',   name:'머핀',       price:2200 }
  ];
  const CATS = [...new Set(PRODUCTS.map(p=>p.cat))];
  const OPTION_PRESET = {
    size: [ ['S','소'], ['M','중'], ['L','대'] ],
    sweet: [ ['0','무가당'], ['50','50%'], ['100','100%'] ],
    ice: [ ['less','적게'], ['normal','보통'], ['more','많이'] ]
  };
  const state = { cart:[], cat:CATS[0] };
  const $ = s=>document.querySelector(s);
  const $$ = s=>Array.from(document.querySelectorAll(s));
  const fmt = v=> v.toLocaleString('ko-KR');

  function renderCats(){
    const wrap = $('#catTabs'); wrap.innerHTML='';
    CATS.forEach(cat=>{
      const b = document.createElement('button'); b.className='chip'+(state.cat===cat?' on':''); b.textContent=cat;
      b.addEventListener('click', ()=>{ state.cat=cat; renderCats(); renderItems(); });
      wrap.appendChild(b);
    });
  }
  function renderItems(){
    const grid=$('#itemGrid'); grid.innerHTML='';
    PRODUCTS.filter(p=>p.cat===state.cat).forEach(p=>{
      const btn=document.createElement('button'); btn.className='item';
      btn.innerHTML=`<div><div style="font-weight:800">${p.name}</div><div class="note">${p.cat}</div></div><div><strong>₩${fmt(p.price)}</strong></div>`;
      btn.addEventListener('click', ()=> openOption(p));
      grid.appendChild(btn);
    });
  }
  function openOption(prod){
    const m=$('#optModal'); $('#optTitle').textContent=`[${prod.name}] 옵션`;
    fill('#optSize','size','M'); fill('#optSweet','sweet','50'); fill('#optIce','ice','normal');
    function fill(sel,key,def){ const row=$(sel); row.innerHTML='';
      for(const [val,label] of OPTION_PRESET[key]){ const b=document.createElement('button'); b.className='chip'; b.textContent=label; b.dataset.group=key; b.dataset.val=val; if(val===def) b.classList.add('on'); b.addEventListener('click',()=>{ $$(`button.chip[data-group="${key}"]`).forEach(x=>x.classList.remove('on')); b.classList.add('on'); }); row.appendChild(b);} }
    $('#optClose').onclick=()=>m.close();
    $('#optOk').onclick=()=>{ const sel=g=> $(`button.chip[data-group="${g}"][class*="on"]`)?.dataset.val; addToCart({ id:prod.id,name:prod.name,price:prod.price,size:sel('size'),sweet:sel('sweet'),ice:sel('ice'),qty:1 }); m.close(); };
    m.showModal();
  }
  function addToCart(item){ const key=`${item.id}-${item.size}-${item.sweet}-${item.ice}`; const f=state.cart.find(it=>`${it.id}-${it.size}-${it.sweet}-${it.ice}`===key); if(f) f.qty+=1; else state.cart.push(item); renderCart(); $('#btnNext').disabled = state.cart.length===0; }
  function renderCart(){ const box=$('#cartList'); box.innerHTML=''; let total=0; state.cart.forEach((it,idx)=>{ const sub=it.price*it.qty; total+=sub; const line=document.createElement('div'); line.className='row'; line.style.justifyContent='space-between'; line.innerHTML=`<div><strong>${it.name}</strong> <span class='note'>(${it.size}/${it.sweet}/${it.ice})×${it.qty}</span></div><div><strong>₩${fmt(sub)}</strong></div>`; box.appendChild(line); }); $('#cartTotal').textContent=`₩${fmt(total)}`; }
  function showConfirm(){ const list=$('#confirmList'); list.innerHTML=''; let total=0; state.cart.forEach(it=>{ const sub=it.price*it.qty; total+=sub; const row=document.createElement('div'); row.className='row'; row.style.justifyContent='space-between'; row.innerHTML=`<div>${it.name} <span class='note'>(${it.size}/${it.sweet}/${it.ice}) × ${it.qty}</span></div><div><strong>₩${fmt(sub)}</strong></div>`; list.appendChild(row); }); $('#confirmTotal').textContent=`₩${fmt(total)}`; document.querySelector('section[aria-labelledby="sec-menu"]').style.display='none'; $('#sectionConfirm').style.display='block'; }
  function showPaid(){ $('#sectionConfirm').style.display='none'; $('#sectionPaid').style.display='block'; $('#orderNo').textContent=(Date.now()%1000000).toString().padStart(6,'0'); }

  $('#btnCancel').addEventListener('click', ()=>{ if(confirm('주문을 취소할까요?')) location.reload(); });
  $('#btnClear').addEventListener('click', ()=>{ state.cart=[]; renderCart(); $('#btnNext').disabled=true; });
  $('#btnNext').addEventListener('click', showConfirm);
  $('#btnBackToMenu').addEventListener('click', ()=>{ $('#sectionConfirm').style.display='none'; document.querySelector('section[aria-labelledby="sec-menu"]').style.display='block'; });
  $('#btnPay').addEventListener('click', showPaid);
  $('#btnNew').addEventListener('click', ()=> location.reload());

  renderCats(); renderItems(); renderCart();
})();
</script>
</body>
</html>
