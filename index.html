<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïä§ÎßàÌä∏ ÌÇ§Ïò§Ïä§ÌÅ¨</title>
    <style>
        /* ===== Í∏∞Î≥∏ Î¶¨ÏÖã ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ===== CSS Î≥ÄÏàò (Í≥µÌÜµ ÏÉâÏÉÅ) ===== */
        :root {
            --primary: #0984E3;
            --secondary: #6C5CE7;
            --accent: #00B894;
            --bg: #F8F9FA;
            --text: #2D3748;
            --border: #E2E8F0;

            /* Ïó∞Î†πÎ≥Ñ ÌÅ¨Í∏∞ Î≥ÄÏàò (Í∏∞Î≥∏Í∞í: ÏÑ±Ïù∏) */
            --font-size: 16px;
            --btn-height: 48px;
            --btn-padding: 14px;
            --gap: 14px;
            --border-radius: 12px;
        }

        /* ===== Ïó∞Î†πÎ≥Ñ ÌÅ¨Í∏∞ ÏÑ§Ï†ï ===== */
        body.age-child {
            --font-size: 24px;
            --btn-height: 70px;
            --btn-padding: 20px;
            --gap: 24px;
            --border-radius: 16px;
        }

        body.age-teen {
            --font-size: 18px;
            --btn-height: 56px;
            --btn-padding: 16px;
            --gap: 18px;
            --border-radius: 14px;
        }

        body.age-adult {
            --font-size: 16px;
            --btn-height: 48px;
            --btn-padding: 14px;
            --gap: 14px;
            --border-radius: 12px;
        }

        body.age-senior {
            --font-size: 32px;
            --btn-height: 90px;
            --btn-padding: 28px;
            --gap: 32px;
            --border-radius: 18px;
            font-weight: 700;
        }

        /* ===== Í∏∞Î≥∏ Ïä§ÌÉÄÏùº ===== */
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            font-size: var(--font-size);
            line-height: 1.6;
        }

        /* ===== Ìó§Îçî ===== */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: calc(var(--gap) * 1.2) var(--gap);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-size: calc(var(--font-size) * 1.5);
            font-weight: 900;
        }

        .header-actions {
            display: flex;
            gap: calc(var(--gap) * 0.8);
        }

        /* ===== Î≤ÑÌäº ===== */
        .btn {
            background: white;
            color: var(--primary);
            border: none;
            border-radius: var(--border-radius);
            padding: calc(var(--btn-padding) * 0.8) calc(var(--btn-padding) * 1.2);
            font-size: calc(var(--font-size) * 0.9);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            height: auto;
            min-height: calc(var(--btn-height) * 0.8);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn.primary {
            background: var(--accent);
            color: white;
        }

        .btn.secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        /* ===== Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ ===== */
        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--gap);
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: var(--gap);
        }

        /* ===== Î©îÎâ¥ ÏÑπÏÖò ===== */
        .menu-section {
            background: white;
            border-radius: var(--border-radius);
            padding: var(--gap);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: calc(var(--font-size) * 1.3);
            font-weight: 800;
            margin-bottom: var(--gap);
            color: var(--text);
        }

        /* ===== Ïπ¥ÌÖåÍ≥†Î¶¨ ===== */
        .categories {
            display: flex;
            gap: calc(var(--gap) * 0.6);
            margin-bottom: var(--gap);
            flex-wrap: wrap;
        }

        .category-btn {
            padding: calc(var(--btn-padding) * 0.7) calc(var(--btn-padding) * 1.2);
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: calc(var(--border-radius) * 2);
            font-size: calc(var(--font-size) * 0.95);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text);
        }

        .category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .category-btn:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        /* ===== Î©îÎâ¥ Í∑∏Î¶¨Îìú ===== */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--gap);
        }

        .menu-item {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: var(--border-radius);
            padding: var(--gap);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: calc(var(--gap) * 0.5);
        }

        .menu-item:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .menu-item-name {
            font-size: calc(var(--font-size) * 1.1);
            font-weight: 800;
            color: var(--text);
        }

        .menu-item-category {
            font-size: calc(var(--font-size) * 0.85);
            color: #718096;
        }

        .menu-item-price {
            font-size: calc(var(--font-size) * 1.2);
            font-weight: 900;
            color: var(--primary);
            margin-top: auto;
        }

        /* ===== Ïû•Î∞îÍµ¨Îãà ===== */
        .cart-section {
            background: white;
            border-radius: var(--border-radius);
            padding: var(--gap);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: var(--gap);
            max-height: calc(100vh - var(--gap) * 2);
            overflow-y: auto;
        }

        .cart-items {
            display: flex;
            flex-direction: column;
            gap: calc(var(--gap) * 0.8);
            margin-bottom: var(--gap);
            max-height: 400px;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: calc(var(--gap) * 0.8);
            background: var(--bg);
            border-radius: calc(var(--border-radius) * 0.8);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .cart-item-options {
            font-size: calc(var(--font-size) * 0.8);
            color: #718096;
        }

        .cart-item-price {
            font-weight: 800;
            color: var(--primary);
            font-size: calc(var(--font-size) * 1.1);
        }

        .cart-total {
            border-top: 2px solid var(--border);
            padding-top: var(--gap);
            margin-top: var(--gap);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-total-label {
            font-size: calc(var(--font-size) * 1.2);
            font-weight: 700;
        }

        .cart-total-amount {
            font-size: calc(var(--font-size) * 1.8);
            font-weight: 900;
            color: var(--primary);
        }

        .cart-actions {
            display: flex;
            flex-direction: column;
            gap: calc(var(--gap) * 0.6);
            margin-top: var(--gap);
        }

        .cart-actions .btn {
            width: 100%;
            height: var(--btn-height);
            font-size: var(--font-size);
        }

        /* ===== Î™®Îã¨ ===== */
        dialog {
            border: none;
            border-radius: var(--border-radius);
            padding: 0;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            margin: 0;
        }

        dialog::backdrop {
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            padding: var(--gap);
        }

        .modal-title {
            font-size: calc(var(--font-size) * 1.4);
            font-weight: 800;
            margin-bottom: var(--gap);
        }

        .modal-options {
            display: flex;
            flex-direction: column;
            gap: var(--gap);
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: calc(var(--gap) * 0.5);
        }

        .option-label {
            font-weight: 700;
            font-size: calc(var(--font-size) * 1.1);
        }

        .option-buttons {
            display: flex;
            gap: calc(var(--gap) * 0.5);
            flex-wrap: wrap;
        }

        .option-btn {
            padding: calc(var(--btn-padding) * 0.7) calc(var(--btn-padding) * 1.2);
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: calc(var(--border-radius) * 2);
            font-size: calc(var(--font-size) * 0.95);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .modal-actions {
            display: flex;
            gap: var(--gap);
            margin-top: var(--gap);
        }

        .modal-actions .btn {
            flex: 1;
            height: var(--btn-height);
        }

        /* ===== Ïó∞Î†π ÏÑ†ÌÉù Î™®Îã¨ ===== */
        .age-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--gap);
            margin-bottom: var(--gap);
        }

        .age-option {
            padding: calc(var(--gap) * 1.5);
            background: var(--bg);
            border: 3px solid var(--border);
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: calc(var(--font-size) * 1.2);
            font-weight: 800;
        }

        .age-option:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        /* ===== Î∞òÏùëÌòï ===== */
        @media (max-width: 1200px) {
            main {
                grid-template-columns: 1fr;
            }

            .cart-section {
                position: static;
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .menu-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ===== Îπà ÏÉÅÌÉú ===== */
        .empty-state {
            text-align: center;
            padding: calc(var(--gap) * 3);
            color: #A0AEC0;
            font-size: calc(var(--font-size) * 1.1);
        }

        /* ===== ÏùåÏÑ± Ïù∏Ïãù ÏÉÅÌÉú ===== */
        .voice-status {
            position: fixed;
            left: 20px;
            top: 100px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: calc(var(--gap) * 0.8) calc(var(--gap) * 1.2);
            border-radius: var(--border-radius);
            font-size: calc(var(--font-size) * 0.9);
            z-index: 2000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-width: 300px;
        }

        .voice-status.hidden {
            display: none;
        }

        /* ===== Ïπ¥Î©îÎùº ÏÉÅÌÉú ===== */
        .camera-status {
            position: fixed;
            right: 20px;
            top: 100px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: calc(var(--gap) * 0.6) calc(var(--gap) * 1);
            border-radius: var(--border-radius);
            font-size: calc(var(--font-size) * 0.8);
            z-index: 2000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .camera-status.hidden {
            display: none;
        }

        /* ===== Ïπ¥Î©îÎùº Ïò§Î≤ÑÎ†àÏù¥ ===== */
        .cam-overlay {
            position: fixed;
            right: 20px;
            top: 100px;
            width: 240px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: var(--border-radius);
            padding: 10px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .cam-overlay video {
            width: 100%;
            height: auto;
            border-radius: 8px;
            background: #000;
        }

        .cam-overlay canvas {
            display: none;
        }

        .cam-overlay .note {
            color: #ddd;
            font-size: 0.85rem;
            text-align: center;
        }

        .cam-hidden {
            display: none !important;
        }

        /* ===== n8n ÏùëÎãµ ÌëúÏãú ===== */
        .n8n-response {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: calc(var(--gap) * 1.2) calc(var(--gap) * 1.5);
            border-radius: var(--border-radius);
            font-size: calc(var(--font-size) * 1.1);
            font-weight: 700;
            z-index: 3000;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            text-align: center;
            animation: slideUp 0.3s ease-out;
        }

        .n8n-response.hidden {
            display: none;
        }

        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body class="age-adult">

    <!-- Ìó§Îçî -->
    <header>
        <div class="logo">üçï Ïä§ÎßàÌä∏ ÌÇ§Ïò§Ïä§ÌÅ¨</div>
        <div class="header-actions">
            <button class="btn secondary" id="cameraBtn">üì∑ Ïπ¥Î©îÎùº</button>
            <button class="btn secondary" id="ageBtn">üë§ Ïó∞Î†π Î≥ÄÍ≤Ω</button>
            <button class="btn secondary" id="voiceBtn">üé§ ÏùåÏÑ± Ï£ºÎ¨∏</button>
        </div>
    </header>

    <!-- ÏùåÏÑ± Ïù∏Ïãù ÏÉÅÌÉú -->
    <div class="voice-status hidden" id="voiceStatus">
        <div id="voiceStatusText">ÏùåÏÑ± Ïù∏Ïãù Ï§ÄÎπÑ Ï§ë...</div>
    </div>

    <!-- Ïπ¥Î©îÎùº ÏÉÅÌÉú -->
    <div class="camera-status hidden" id="cameraStatus">
        üì∑ Ïπ¥Î©îÎùº ÎåÄÍ∏∞ Ï§ë
    </div>

    <!-- Ïπ¥Î©îÎùº Ïò§Î≤ÑÎ†àÏù¥ (Î≥µÏõê) -->
    <div id="camOverlay" class="cam-overlay cam-hidden">
        <video id="camVideo" autoplay muted playsinline></video>
        <canvas id="camCanvas"></canvas>
        <div class="note" id="camStatusText">Ïπ¥Î©îÎùº: ÎπÑÌôúÏÑ±</div>
    </div>

    <!-- n8n ÏùëÎãµ ÌëúÏãú -->
    <div class="n8n-response hidden" id="n8nResponse">
        <div id="n8nResponseText"></div>
    </div>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
    <main>
        <!-- Î©îÎâ¥ ÏÑπÏÖò -->
        <div class="menu-section">
            <h2 class="section-title">Î©îÎâ¥ ÏÑ†ÌÉù</h2>

            <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ -->
            <div class="categories" id="categories"></div>

            <!-- Î©îÎâ¥ Í∑∏Î¶¨Îìú -->
            <div class="menu-grid" id="menuGrid"></div>
        </div>

        <!-- Ïû•Î∞îÍµ¨Îãà -->
        <div class="cart-section">
            <h2 class="section-title">Ïû•Î∞îÍµ¨Îãà</h2>

            <div class="cart-items" id="cartItems">
                <div class="empty-state">Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§</div>
            </div>

            <div class="cart-total">
                <div class="cart-total-label">Ìï©Í≥Ñ</div>
                <div class="cart-total-amount" id="cartTotal">‚Ç©0</div>
            </div>

            <div class="cart-actions">
                <button class="btn" id="clearBtn">üóëÔ∏è ÎπÑÏö∞Í∏∞</button>
                <button class="btn primary" id="orderBtn" disabled>Ï£ºÎ¨∏ÌïòÍ∏∞</button>
            </div>
        </div>
    </main>

    <!-- Ïó∞Î†π ÏÑ†ÌÉù Î™®Îã¨ -->
    <dialog id="ageModal">
        <div class="modal-content">
            <h3 class="modal-title">Ïó∞Î†πÎåÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</h3>
            <div class="age-selector">
                <div class="age-option" data-age="child">
                    <div style="font-size: 3rem;">üë∂</div>
                    <div>Ïñ¥Î¶∞Ïù¥</div>
                    <div style="font-size: 0.8em; color: #718096;">(0-12ÏÑ∏)</div>
                </div>
                <div class="age-option" data-age="teen">
                    <div style="font-size: 3rem;">üßë</div>
                    <div>Ï≤≠ÏÜåÎÖÑ</div>
                    <div style="font-size: 0.8em; color: #718096;">(13-19ÏÑ∏)</div>
                </div>
                <div class="age-option" data-age="adult">
                    <div style="font-size: 3rem;">üë®</div>
                    <div>ÏÑ±Ïù∏</div>
                    <div style="font-size: 0.8em; color: #718096;">(20-64ÏÑ∏)</div>
                </div>
                <div class="age-option" data-age="senior">
                    <div style="font-size: 3rem;">üë¥</div>
                    <div>ÎÖ∏Ïù∏</div>
                    <div style="font-size: 0.8em; color: #718096;">(65ÏÑ∏ Ïù¥ÏÉÅ)</div>
                </div>
            </div>
            <button class="btn" onclick="document.getElementById('ageModal').close()" style="width: 100%;">Îã´Í∏∞</button>
        </div>
    </dialog>

    <!-- ÏòµÏÖò ÏÑ†ÌÉù Î™®Îã¨ -->
    <dialog id="optionModal">
        <div class="modal-content">
            <h3 class="modal-title" id="optionTitle">ÏòµÏÖò ÏÑ†ÌÉù</h3>

            <div class="modal-options">
                <div class="option-group">
                    <div class="option-label">ÏÇ¨Ïù¥Ï¶à</div>
                    <div class="option-buttons" id="sizeOptions"></div>
                </div>

                <div class="option-group">
                    <div class="option-label">ÎãπÎèÑ</div>
                    <div class="option-buttons" id="sweetOptions"></div>
                </div>

                <div class="option-group">
                    <div class="option-label">ÏñºÏùå</div>
                    <div class="option-buttons" id="iceOptions"></div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn" id="optionCancelBtn">Ï∑®ÏÜå</button>
                <button class="btn primary" id="optionConfirmBtn">Îã¥Í∏∞</button>
            </div>
        </div>
    </dialog>

    <script>
        // Î©îÎâ¥ Îç∞Ïù¥ÌÑ∞
        const PRODUCTS = [
            { id: 'a1', cat: 'Ïª§Ìîº', name: 'ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏', price: 2500 },
            { id: 'a2', cat: 'Ïª§Ìîº', name: 'Ïπ¥ÌéòÎùºÎñº', price: 3200 },
            { id: 'a3', cat: 'Ïª§Ìîº', name: 'Î∞îÎãêÎùºÎùºÎñº', price: 3600 },
            { id: 'a4', cat: 'Ïª§Ìîº', name: 'Ïπ¥ÎùºÎ©ú ÎßàÎÅºÏïÑÎòê', price: 3800 },
            { id: 't1', cat: 'Ìã∞', name: 'ÎÖπÏ∞®', price: 2800 },
            { id: 't2', cat: 'Ìã∞', name: 'ÏñºÍ∑∏Î†àÏù¥', price: 3000 },
            { id: 't3', cat: 'Ìã∞', name: 'Ï∫êÎ™®ÎßàÏùº', price: 3000 },
            { id: 'c1', cat: 'ÎîîÏ†ÄÌä∏', name: 'Ìï´Ï¥àÏΩî', price: 3000 },
            { id: 's1', cat: 'ÎîîÏ†ÄÌä∏', name: 'Ïø†ÌÇ§', price: 1800 },
            { id: 's2', cat: 'ÎîîÏ†ÄÌä∏', name: 'Î®∏ÌïÄ', price: 2200 },
        ];

        const CATEGORIES = [...new Set(PRODUCTS.map(p => p.cat))];

        const OPTIONS = {
            size: [['S', 'ÏÜå'], ['M', 'Ï§ë'], ['L', 'ÎåÄ']],
            sweet: [['0', 'Î¨¥Í∞ÄÎãπ'], ['50', '50%'], ['100', '100%']],
            ice: [['less', 'Ï†ÅÍ≤å'], ['normal', 'Î≥¥ÌÜµ'], ['more', 'ÎßéÏù¥']]
        };

        // ÏÉÅÌÉú
        let currentCategory = CATEGORIES[0];
        let cart = [];
        let selectedProduct = null;
        let selectedOptions = { size: 'M', sweet: '50', ice: 'normal' };

        // Ï¥àÍ∏∞Ìôî
        function init() {
            renderCategories();
            renderMenu();
            renderCart();
            setupEventListeners();

            // Ï¥àÍ∏∞ Ïó∞Î†π ÏÑ†ÌÉù
            setTimeout(() => {
                document.getElementById('ageModal').showModal();
            }, 500);
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ Î†åÎçîÎßÅ
        function renderCategories() {
            const container = document.getElementById('categories');
            container.innerHTML = CATEGORIES.map(cat => `
        <button class="category-btn ${cat === currentCategory ? 'active' : ''}" 
                onclick="selectCategory('${cat}')">
          ${cat}
        </button>
      `).join('');
        }

        // Î©îÎâ¥ Î†åÎçîÎßÅ
        function renderMenu() {
            const container = document.getElementById('menuGrid');
            const items = PRODUCTS.filter(p => p.cat === currentCategory);

            container.innerHTML = items.map(item => `
        <div class="menu-item" onclick="selectMenu('${item.id}')">
          <div class="menu-item-name">${item.name}</div>
          <div class="menu-item-category">${item.cat}</div>
          <div class="menu-item-price">‚Ç©${item.price.toLocaleString()}</div>
        </div>
      `).join('');
        }

        // Ïû•Î∞îÍµ¨Îãà Î†åÎçîÎßÅ
        function renderCart() {
            const container = document.getElementById('cartItems');
            const totalEl = document.getElementById('cartTotal');
            const orderBtn = document.getElementById('orderBtn');

            if (cart.length === 0) {
                container.innerHTML = '<div class="empty-state">Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§</div>';
                totalEl.textContent = '‚Ç©0';
                orderBtn.disabled = true;
                return;
            }

            let total = 0;
            container.innerHTML = cart.map((item, idx) => {
                const subtotal = item.price * item.qty;
                total += subtotal;
                return `
          <div class="cart-item">
            <div class="cart-item-info">
              <div class="cart-item-name">${item.name} x${item.qty}</div>
              <div class="cart-item-options">${item.size} / ${item.sweet} / ${item.ice}</div>
            </div>
            <div class="cart-item-price">‚Ç©${subtotal.toLocaleString()}</div>
          </div>
        `;
            }).join('');

            totalEl.textContent = `‚Ç©${total.toLocaleString()}`;
            orderBtn.disabled = false;
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù
        function selectCategory(cat) {
            currentCategory = cat;
            renderCategories();
            renderMenu();
        }

        // Î©îÎâ¥ ÏÑ†ÌÉù
        function selectMenu(id) {
            selectedProduct = PRODUCTS.find(p => p.id === id);
            selectedOptions = { size: 'M', sweet: '50', ice: 'normal' };

            document.getElementById('optionTitle').textContent = `[${selectedProduct.name}] ÏòµÏÖò ÏÑ†ÌÉù`;

            // ÏòµÏÖò Î≤ÑÌäº Î†åÎçîÎßÅ
            renderOptions('sizeOptions', 'size', OPTIONS.size);
            renderOptions('sweetOptions', 'sweet', OPTIONS.sweet);
            renderOptions('iceOptions', 'ice', OPTIONS.ice);

            document.getElementById('optionModal').showModal();
        }

        // ÏòµÏÖò Î†åÎçîÎßÅ
        function renderOptions(containerId, optionType, options) {
            const container = document.getElementById(containerId);
            container.innerHTML = options.map(([value, label]) => `
        <button class="option-btn ${selectedOptions[optionType] === value ? 'selected' : ''}"
                onclick="selectOption('${optionType}', '${value}')">
          ${label}
        </button>
      `).join('');
        }

        // ÏòµÏÖò ÏÑ†ÌÉù
        function selectOption(type, value) {
            selectedOptions[type] = value;
            renderOptions('sizeOptions', 'size', OPTIONS.size);
            renderOptions('sweetOptions', 'sweet', OPTIONS.sweet);
            renderOptions('iceOptions', 'ice', OPTIONS.ice);
        }

        // Ïû•Î∞îÍµ¨ÎãàÏóê Ï∂îÍ∞Ä
        function addToCart() {
            const key = `${selectedProduct.id}-${selectedOptions.size}-${selectedOptions.sweet}-${selectedOptions.ice}`;
            const existing = cart.find(item =>
                `${item.id}-${item.size}-${item.sweet}-${item.ice}` === key
            );

            if (existing) {
                existing.qty += 1;
            } else {
                cart.push({
                    ...selectedProduct,
                    ...selectedOptions,
                    qty: 1
                });
            }

            renderCart();
            document.getElementById('optionModal').close();
        }

        // Ïû•Î∞îÍµ¨Îãà ÎπÑÏö∞Í∏∞
        function clearCart() {
            if (confirm('Ïû•Î∞îÍµ¨ÎãàÎ•º ÎπÑÏö∞ÏãúÍ≤†ÏäµÎãàÍπå?')) {
                cart = [];
                renderCart();
            }
        }

        // Ï£ºÎ¨∏ÌïòÍ∏∞
        function order() {
            if (cart.length === 0) return;

            const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            alert(`Ï£ºÎ¨∏Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\nÏ¥ù Í∏àÏï°: ‚Ç©${total.toLocaleString()}`);
            cart = [];
            renderCart();
        }

        // Ïó∞Î†π ÏÑ†ÌÉù
        function selectAge(age) {
            document.body.className = `age-${age}`;
            document.getElementById('ageModal').close();

            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
            try {
                localStorage.setItem('kioskAgeGroup', age);
            } catch (e) { }
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupEventListeners() {
            // Ïó∞Î†π ÏÑ†ÌÉù
            document.querySelectorAll('.age-option').forEach(el => {
                el.addEventListener('click', () => selectAge(el.dataset.age));
            });

            // Ïó∞Î†π Î≥ÄÍ≤Ω Î≤ÑÌäº
            document.getElementById('ageBtn').addEventListener('click', () => {
                document.getElementById('ageModal').showModal();
            });

            // ÏòµÏÖò Î™®Îã¨
            document.getElementById('optionCancelBtn').addEventListener('click', () => {
                document.getElementById('optionModal').close();
            });

            document.getElementById('optionConfirmBtn').addEventListener('click', addToCart);

            // Ïû•Î∞îÍµ¨Îãà
            document.getElementById('clearBtn').addEventListener('click', clearCart);
            document.getElementById('orderBtn').addEventListener('click', order);

            // Ï†ÄÏû•Îêú Ïó∞Î†π Î≥µÏõê
            try {
                const savedAge = localStorage.getItem('kioskAgeGroup');
                if (savedAge) {
                    document.body.className = `age-${savedAge}`;
                }
            } catch (e) { }
        }

        // Ï¥àÍ∏∞Ìôî Ïã§Ìñâ
        init();
    </script>

    <!-- face-api.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

    <!-- ÏùåÏÑ± Ïù∏Ïãù Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script src="static/voice_recognition.js"></script>

    <!-- Ïπ¥Î©îÎùº Ïó∞Î†π Í∞êÏßÄ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script src="static/age_detection.js"></script>

    <!-- Ïπ¥Î©îÎùº Î≤ÑÌäº Ïù¥Î≤§Ìä∏ -->
    <script>
        const $cameraBtn = document.getElementById('cameraBtn');
        const $cameraStatus = document.getElementById('cameraStatus');
        let cameraActive = false;

        if ($cameraBtn) {
            $cameraBtn.addEventListener('click', async () => {
                if (!cameraActive) {
                    // Ïπ¥Î©îÎùº ÏãúÏûë
                    $cameraStatus.classList.remove('hidden');
                    $cameraStatus.textContent = 'üì∑ Ïπ¥Î©îÎùº ÏãúÏûë Ï§ë...';

                    try {
                        await startAgeDetection();
                        cameraActive = true;
                        $cameraBtn.textContent = 'üì∑ Ïπ¥Î©îÎùº Ï§ëÏßÄ';
                        $cameraBtn.classList.add('primary');
                        $cameraStatus.textContent = 'üì∑ Ïó∞Î†π Í∞êÏßÄ Ï§ë';
                    } catch (error) {
                        $cameraStatus.textContent = '‚ùå Ïπ¥Î©îÎùº Ïò§Î•ò';
                        setTimeout(() => $cameraStatus.classList.add('hidden'), 3000);
                    }
                } else {
                    // Ïπ¥Î©îÎùº Ï§ëÏßÄ
                    stopAgeDetection();
                    cameraActive = false;
                    $cameraBtn.textContent = 'üì∑ Ïπ¥Î©îÎùº';
                    $cameraBtn.classList.remove('primary');
                    $cameraStatus.textContent = 'üì∑ Ïπ¥Î©îÎùº Ï§ëÏßÄÎê®';
                    setTimeout(() => $cameraStatus.classList.add('hidden'), 2000);
                }
            });
        }
    </script>
</body>

</html>